<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¨Ø±Ùâ€ŒÚ©Ùˆ | Ø¯Ø³ØªÛŒØ§Ø± Ù‡ÙˆØ´Ù…Ù†Ø¯ Ø§Ø³Ú©ÛŒ</title>
    <meta name="description" content="Ù¾ÛŒØ´â€ŒØ¨ÛŒÙ†ÛŒ ØªØ®ØµØµÛŒØŒ Ø§ÛŒÙ…Ù†ÛŒ Ùˆ ÙˆØ¶Ø¹ÛŒØª Ø¨Ø±Ù Ù¾ÛŒØ³Øªâ€ŒÙ‡Ø§ÛŒ Ø§Ø³Ú©ÛŒ Ø§ÛŒØ±Ø§Ù†">
    
    <!-- Version: v2.2 -->
    
    <!-- Fonts: Vazirmatn -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@100;300;400;500;600;700;800;900&display=swap" rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Custom Styles -->
    <style>
        body {
            font-family: 'Vazirmatn', sans-serif;
            transition: background-color 0.5s ease, color 0.5s ease;
        }

        .dir-ltr { direction: ltr; display: inline-block; unicode-bidi: isolate; }
        .hide-scroll::-webkit-scrollbar { display: none; }
        .hide-scroll { -ms-overflow-style: none; scrollbar-width: none; }

        /* Themes */
        .theme-snow {
            --bg-main: #f0f9ff;
            --bg-gradient: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
            --bg-card: rgba(255, 255, 255, 0.85);
            --text-primary: #0f172a;
            --accent: #0ea5e9;
            --border: #e0f2fe;
            --card-shadow: 0 10px 30px -10px rgba(14, 165, 233, 0.15);
        }
        .theme-sun {
            --bg-main: #fffbeb;
            --bg-gradient: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
            --bg-card: rgba(255, 255, 255, 0.9);
            --text-primary: #451a03;
            --accent: #f59e0b;
            --border: #fef3c7;
            --card-shadow: 0 10px 30px -10px rgba(245, 158, 11, 0.15);
        }
        .theme-night {
            --bg-main: #0f172a;
            --bg-gradient: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            --bg-card: rgba(30, 41, 59, 0.8);
            --text-primary: #f8fafc;
            --accent: #818cf8;
            --border: #334155;
            --card-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.5);
        }
        
        body { background: var(--bg-gradient); color: var(--text-primary); min-height: 100vh; }

        .glass-card {
            background-color: var(--bg-card);
            backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            box-shadow: var(--card-shadow);
        }

        .accent-bg { background-color: var(--accent); }
        .accent-text { color: var(--accent); }

        /* Animations */
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-6px); } 100% { transform: translateY(0px); } }
        .animate-float { animation: float 5s ease-in-out infinite; }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in { animation: fadeIn 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards; }

        @keyframes spin-slow { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes spin-fast { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        @keyframes burst { 0% { transform: rotate(0deg) scale(1); } 50% { transform: rotate(180deg) scale(1.2); } 100% { transform: rotate(360deg) scale(1); } }
        
        .spin-slow { animation: spin-slow 20s linear infinite; }
        
        /* Snow particles animation */
        @keyframes snowfall {
            0% { transform: translateY(-10px) translateX(0); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateY(80px) translateX(10px); opacity: 0; }
        }
        .snow-particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: white;
            border-radius: 50%;
            opacity: 0;
            animation: snowfall 3s linear infinite;
        }
        .snow-particle:nth-child(1) { left: 20%; animation-delay: 0s; }
        .snow-particle:nth-child(2) { left: 40%; animation-delay: 0.5s; }
        .snow-particle:nth-child(3) { left: 60%; animation-delay: 1s; }
        .snow-particle:nth-child(4) { left: 80%; animation-delay: 1.5s; }
        .snow-particle:nth-child(5) { left: 30%; animation-delay: 2s; }
        .snow-particle:nth-child(6) { left: 70%; animation-delay: 2.5s; }

        /* Status Colors */
        .status-go { background: linear-gradient(to right, #dcfce7, #bbf7d0); color: #14532d; border: 1px solid #86efac; }
        .status-caution { background: linear-gradient(to right, #fef9c3, #fde047); color: #713f12; border: 1px solid #facc15; }
        .status-stop { background: linear-gradient(to right, #fee2e2, #fecaca); color: #7f1d1d; border: 1px solid #fca5a5; }
    </style>
</head>
<body class="theme-snow flex flex-col">

    <!-- Header -->
    <header class="w-full px-6 py-8 flex justify-between items-center max-w-7xl mx-auto z-40">
        <div class="flex items-center gap-4">
            <div class="p-3 rounded-2xl accent-bg text-white shadow-lg shadow-current/20 animate-float">
                <i data-lucide="mountain-snow" class="w-8 h-8"></i>
            </div>
            <div>
                <h1 class="text-3xl font-black tracking-tight text-current">Ø¨Ø±Ùâ€ŒÚ©Ùˆ</h1>
                <p class="text-xs opacity-70 font-bold mt-1">Ø¯Ø³ØªÛŒØ§Ø± Ù‡ÙˆØ´Ù…Ù†Ø¯ Ùˆ Ø§ÛŒÙ…Ù†ÛŒ Ø§Ø³Ú©ÛŒâ€ŒØ¨Ø§Ø²Ø§Ù†</p>
            </div>
        </div>

        <div class="flex gap-3 items-center">
            <button onclick="showGuides()" class="px-4 py-2 rounded-full bg-white/20 backdrop-blur-xl border border-current/10 hover:bg-white/40 transition-all flex items-center gap-2">
                <i data-lucide="book-open" class="w-5 h-5"></i>
                <span class="font-bold text-sm">Ø±Ø§Ù‡Ù†Ù…Ø§</span>
            </button>
            <div class="flex bg-white/20 backdrop-blur-xl rounded-full p-1.5 border border-current/10 shadow-sm">
                <button onclick="setTheme('theme-sun')" class="p-2.5 rounded-full hover:bg-white/40 transition-all text-amber-500"><i data-lucide="sun" class="w-5 h-5"></i></button>
                <button onclick="setTheme('theme-snow')" class="p-2.5 rounded-full hover:bg-white/40 transition-all text-sky-500"><i data-lucide="snowflake" class="w-5 h-5"></i></button>
                <button onclick="setTheme('theme-night')" class="p-2.5 rounded-full hover:bg-white/40 transition-all text-indigo-400"><i data-lucide="moon" class="w-5 h-5"></i></button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-grow px-4 pb-16 max-w-7xl mx-auto w-full relative z-0">
        
        <!-- Modal -->
        <div id="hourly-modal" class="fixed inset-0 z-[100] hidden flex-col items-center justify-center bg-black/60 backdrop-blur-sm p-4 fade-in" onclick="closeModal(event)">
            <div class="glass-card w-full max-w-4xl max-h-[90vh] overflow-y-auto rounded-[2.5rem] p-0 shadow-2xl relative" onclick="event.stopPropagation()">
                <div class="sticky top-0 bg-white/80 backdrop-blur-xl p-5 border-b border-current/5 flex justify-between items-center z-10">
                    <div>
                        <span class="font-black text-xl block" id="modal-title">Ø¹Ù†ÙˆØ§Ù†</span>
                        <span class="text-xs opacity-60 font-bold" id="modal-subtitle">ØªØ­Ù„ÛŒÙ„ Ø¯Ù‚ÛŒÙ‚ Ø´Ø±Ø§ÛŒØ· Ø¬ÙˆÛŒ</span>
                    </div>
                    <button onclick="closeModal()" class="p-2 bg-black/5 rounded-full hover:bg-black/10 transition-colors"><i data-lucide="x" class="w-6 h-6"></i></button>
                </div>
                <div id="modal-content" class="p-6 flex flex-col gap-6"></div>
            </div>
        </div>

        <!-- Resort Selector -->
        <div class="flex flex-col items-center my-10 gap-10">
            <div class="glass-card rounded-2xl p-2 flex flex-wrap justify-center gap-1 shadow-sm">
                <button onclick="loadResort('tochal')" id="btn-tochal" class="resort-btn px-6 py-3 rounded-xl font-bold text-sm transition-all duration-300 hover:bg-current/5 opacity-70">ØªÙˆÚ†Ø§Ù„</button>
                <button onclick="loadResort('dizin')" id="btn-dizin" class="resort-btn px-6 py-3 rounded-xl font-bold text-sm transition-all duration-300 hover:bg-current/5 opacity-70">Ø¯ÛŒØ²ÛŒÙ†</button>
                <button onclick="loadResort('darbandsar')" id="btn-darbandsar" class="resort-btn px-6 py-3 rounded-xl font-bold text-sm transition-all duration-300 hover:bg-current/5 opacity-70">Ø¯Ø±Ø¨Ù†Ø¯Ø³Ø±</button>
                <button onclick="loadResort('shemshak')" id="btn-shemshak" class="resort-btn px-6 py-3 rounded-xl font-bold text-sm transition-all duration-300 hover:bg-current/5 opacity-70">Ø´Ù…Ø´Ú©</button>
            </div>

            <!-- Magic Button -->
            <div class="flex flex-col items-center gap-4 w-full max-w-sm mx-auto perspective-1000">
                <button onclick="askWhenSnow()" class="group relative w-24 h-24 rounded-full accent-bg text-white shadow-xl shadow-current/20 hover:shadow-2xl transition-all hover:-translate-y-1 active:scale-95 ring-4 ring-white/30 overflow-hidden flex items-center justify-center">
                    <i data-lucide="snowflake" class="w-12 h-12 spin-slow"></i>
                </button>
                <span class="font-black text-lg">Ú©ÛŒ Ø¨Ø±Ù Ù…ÛŒØ§Ø¯ØŸ</span>
            </div>
        </div>

        <!-- Snow Prediction Result (Wide) -->
        <div id="prediction-result" class="w-full max-w-7xl mx-auto hidden fade-in mb-8"></div>

        <!-- Date Selector -->
        <div id="date-selector-container" class="w-full max-w-4xl mx-auto mb-12 hidden fade-in">
            <div class="glass-card p-2.5 rounded-3xl overflow-x-auto hide-scroll flex gap-3 justify-start md:justify-center" id="date-selector-list"></div>
        </div>

        <!-- Loading -->
        <div id="loading" class="hidden flex-col items-center justify-center py-24 opacity-50">
            <div class="relative">
                <div class="w-16 h-16 border-4 border-current/10 border-t-accent rounded-full animate-spin"></div>
                <i data-lucide="snowflake" class="absolute inset-0 m-auto w-6 h-6 text-current/30 animate-pulse"></i>
            </div>
            <p class="text-sm font-bold mt-6 animate-pulse opacity-70">Ø¯Ø± Ø­Ø§Ù„ ØªØ­Ù„ÛŒÙ„ Ø¯Ø§Ø¯Ù‡â€ŒÙ‡Ø§ÛŒ Ù…Ø§Ù‡ÙˆØ§Ø±Ù‡â€ŒØ§ÛŒ...</p>
        </div>

        <!-- Resort Content -->
        <div id="content-area" class="space-y-16"></div>

        <!-- Educational Guides (Hidden) -->
        <section id="guides-section" class="hidden mt-24 pt-12 border-t border-current/10">
            <div class="flex items-center gap-4 mb-10 justify-center md:justify-start">
                <div class="p-3 rounded-2xl bg-blue-100/50 text-blue-700 shadow-sm"><i data-lucide="book-open-check" class="w-6 h-6"></i></div>
                <h2 class="text-3xl font-black">Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ ÙÙ†ÛŒ Ùˆ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯Ù‡Ø§</h2>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Wind Table -->
                <div class="glass-card p-6 rounded-[2rem] relative overflow-hidden group hover:shadow-lg transition-all duration-500">
                    <div class="absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r from-blue-400 to-cyan-500"></div>
                    <h3 class="font-bold text-lg mb-6 flex items-center gap-2 text-blue-900">
                        <i data-lucide="wind" class="w-5 h-5 text-blue-500"></i>
                        Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ Ø¨Ø§Ø¯ Ùˆ Ù„ÛŒÙØª
                    </h3>
                    <div class="space-y-3 text-xs opacity-90 h-[320px] overflow-y-auto pr-2 scrollbar-thin">
                        <div class="p-3 rounded-xl bg-green-50/50 border border-green-100">
                            <div class="flex justify-between font-black text-green-700 mb-1"><span class="dir-ltr">0-20 km/h</span><span>Ø§ÛŒØ¯Ù‡â€ŒØ¢Ù„</span></div>
                            <p class="opacity-70 leading-relaxed">Ø´Ø±Ø§ÛŒØ· Ø¹Ø§Ù„ÛŒ. ØªÙ…Ø§Ù… Ù„ÛŒÙØªâ€ŒÙ‡Ø§ Ø¨Ø§Ø².</p>
                        </div>
                         <div class="p-3 rounded-xl bg-blue-50/50 border border-blue-100">
                            <div class="flex justify-between font-black text-blue-700 mb-1"><span class="dir-ltr">20-30 km/h</span><span>Ù…Ø­Ø³ÙˆØ³</span></div>
                            <p class="opacity-70 leading-relaxed">Ø¨Ø±Ù Ú©Ù…ÛŒ Ø¬Ø§Ø¨Ø¬Ø§ Ù…ÛŒâ€ŒØ´ÙˆØ¯ (Wind-drift). Ù„ÛŒÙØªâ€ŒÙ‡Ø§ Ø¨Ø§Ø².</p>
                        </div>
                        <div class="p-3 rounded-xl bg-yellow-50/50 border border-yellow-100">
                            <div class="flex justify-between font-black text-yellow-700 mb-1"><span class="dir-ltr">30-40 km/h</span><span>Ù…Ø´Ú©Ù„ Ù„Ø¨Ù‡â€ŒÚ¯ÛŒØ±ÛŒ</span></div>
                            <p class="opacity-70 leading-relaxed">ÛŒØ®â€ŒØ²Ø§ÛŒÛŒ Ø³Ø·Ø­ÛŒ. Ú©Ø§Ù‡Ø´ Ø¯ÛŒØ¯. Ø§Ø­ØªÙ…Ø§Ù„ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ù„ÛŒÙØª.</p>
                        </div>
                        <div class="p-3 rounded-xl bg-orange-50/50 border border-orange-100">
                            <div class="flex justify-between font-black text-orange-700 mb-1"><span class="dir-ltr">40-60 km/h</span><span>Ø±ÛŒØ³Ú© Ø¨Ø§Ù„Ø§</span></div>
                            <p class="opacity-70 leading-relaxed">ØªÙ„Ù‡â€ŒØ³ÛŒÚ˜Ù‡Ø§ ØºØ§Ù„Ø¨Ø§Ù‹ Ø¨Ø³ØªÙ‡. Ø¨Ø±Ù Ø³ÙØª/ÛŒØ®â€ŒØ²Ø¯Ù‡. Whiteout.</p>
                        </div>
                        <div class="p-3 rounded-xl bg-red-50/50 border border-red-100">
                            <div class="flex justify-between font-black text-red-700 mb-1"><span class="dir-ltr">60+ km/h</span><span>Ø·ÙˆÙØ§Ù†</span></div>
                            <p class="opacity-70 leading-relaxed">ØªØ¹Ø·ÛŒÙ„ÛŒ Ú©Ø§Ù…Ù„ Ù¾ÛŒØ³Øª. Ø¯ÛŒØ¯ Ù†Ø²Ø¯ÛŒÚ© ØµÙØ±.</p>
                        </div>
                    </div>
                </div>
                
                <!-- CAPE Guide -->
                <div class="glass-card p-6 rounded-[2rem] relative overflow-hidden group hover:shadow-lg transition-all duration-500">
                    <div class="absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r from-purple-400 to-pink-600"></div>
                    <h3 class="font-bold text-lg mb-6 flex items-center gap-2 text-purple-900">
                        <i data-lucide="zap" class="w-5 h-5 text-purple-500"></i>
                        Ù†Ø§Ù¾Ø§ÛŒØ¯Ø§Ø±ÛŒ Ø¬Ùˆ (CAPE)
                    </h3>
                     <div class="space-y-3 text-xs opacity-90 h-[320px] overflow-y-auto pr-2">
                        <div class="p-3 rounded-xl bg-green-50/50 border border-green-100">
                            <div class="flex justify-between font-black text-green-700 mb-1"><span class="dir-ltr">0</span><span>Ù¾Ø§ÛŒØ¯Ø§Ø±</span></div>
                            <p class="opacity-70">Ø¨Ù‡ØªØ±ÛŒÙ† Ø²Ù…Ø§Ù†Ø› Ø±Ø¹Ø¯ÙˆØ¨Ø±Ù‚ â‰ˆ ØµÙØ±</p>
                        </div>
                         <div class="p-3 rounded-xl bg-teal-50/50 border border-teal-100">
                            <div class="flex justify-between font-black text-teal-700 mb-1"><span class="dir-ltr">1-500</span><span>Ù†Ø§Ù¾Ø§ÛŒØ¯Ø§Ø±ÛŒ Ú©Ù…</span></div>
                            <p class="opacity-70">ØªØºÛŒÛŒØ±Ø§Øª Ù…Ø­Ù„ÛŒ Ú©ÙˆÚ†Ú© ÛŒØ§ Ø±Ú¯Ø¨Ø§Ø± Ù¾Ø±Ø§Ú©Ù†Ø¯Ù‡.</p>
                        </div>
                         <div class="p-3 rounded-xl bg-orange-50/50 border border-orange-100">
                            <div class="flex justify-between font-black text-orange-700 mb-1"><span class="dir-ltr">500-1000</span><span>Ø±Ø¹Ø¯ÙˆØ¨Ø±Ù‚ Ù¾Ø±Ø§Ú©Ù†Ø¯Ù‡</span></div>
                            <p class="opacity-70">Ø§Ø­ØªÛŒØ§Ø·Ø› Ø§Ø­ØªÙ…Ø§Ù„ ÙˆØ²Ø´ Ø¨Ø§Ø¯ Ù†Ø§Ú¯Ù‡Ø§Ù†ÛŒ (Gust).</p>
                        </div>
                         <div class="p-3 rounded-xl bg-red-50/50 border border-red-100">
                            <div class="flex justify-between font-black text-red-700 mb-1"><span class="dir-ltr">1000+</span><span>ØªÙˆÙØ§Ù† Ø®Ø·Ø±Ù†Ø§Ú©</span></div>
                            <p class="opacity-70">Ø®Ø·Ø± ØµØ§Ø¹Ù‚Ù‡ Ø¨Ø§Ù„Ø§. Ø§Ø±ØªÙØ§Ø¹Ø§Øª Ù†Ø±ÙˆÛŒØ¯.</p>
                        </div>
                    </div>
                </div>

                <!-- Lens Guide -->
                <div class="glass-card p-6 rounded-[2rem] relative overflow-hidden group hover:shadow-lg transition-all duration-500">
                    <div class="absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r from-orange-400 to-amber-500"></div>
                    <h3 class="font-bold text-lg mb-6 flex items-center gap-2 text-amber-900">
                        <i data-lucide="glasses" class="w-5 h-5 text-amber-500"></i>
                        Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù„Ù†Ø²
                    </h3>
                    <div class="space-y-3 text-xs opacity-90 h-[320px] overflow-y-auto pr-2">
                        <div class="p-3 rounded-xl bg-gray-100/50 border border-gray-200">
                            <div class="flex justify-between font-black text-gray-700 mb-1"><span>Ø¢ÙØªØ§Ø¨ÛŒ Ø´Ø¯ÛŒØ¯</span><span class="dir-ltr">5-10%</span></div>
                            <p class="opacity-70">Ù„Ù†Ø² ØªÛŒØ±Ù‡/Ø¢ÛŒÙ†Ù‡â€ŒØ§ÛŒ. Ú©Ø§Ù‡Ø´ Ø®ÛŒØ±Ú¯ÛŒ.</p>
                        </div>
                        <div class="p-3 rounded-xl bg-amber-50/50 border border-amber-100">
                            <div class="flex justify-between font-black text-amber-700 mb-1"><span>Ø¢ÙØªØ§Ø¨ÛŒ Ù…ØªÙˆØ³Ø·</span><span class="dir-ltr">10-25%</span></div>
                            <p class="opacity-70">Ù„Ù†Ø² Ù‚Ù‡ÙˆÙ‡â€ŒØ§ÛŒ/Ø¨Ø±Ù†Ø²ÛŒ. ØªØ´Ø®ÛŒØµ Ø¹Ù…Ù‚.</p>
                        </div>
                        <div class="p-3 rounded-xl bg-orange-50/50 border border-orange-100">
                            <div class="flex justify-between font-black text-orange-700 mb-1"><span>Ù…ØªØºÛŒØ± / Ù†ÛŒÙ…Ù‡â€ŒØ§Ø¨Ø±ÛŒ</span><span class="dir-ltr">18-35%</span></div>
                            <p class="opacity-70">Ù„Ù†Ø² Ù†Ø§Ø±Ù†Ø¬ÛŒ/Ø±Ø². ØªÙ‚ÙˆÛŒØª Ø³Ø§ÛŒÙ‡â€ŒÙ‡Ø§.</p>
                        </div>
                         <div class="p-3 rounded-xl bg-rose-50/50 border border-rose-100">
                            <div class="flex justify-between font-black text-rose-700 mb-1"><span>Ù†ÙˆØ± ØªØ®Øª (Flat)</span><span class="dir-ltr">35-60%</span></div>
                            <p class="opacity-70">Ù„Ù†Ø² ØµÙˆØ±ØªÛŒ/Ø²Ø±Ø¯ Ø±ÙˆØ´Ù†. Ø¢Ø´Ú©Ø§Ø±Ø³Ø§Ø²ÛŒ Ù¾Ø³ØªÛŒ Ø¨Ù„Ù†Ø¯ÛŒ.</p>
                        </div>
                        <div class="p-3 rounded-xl bg-yellow-50/50 border border-yellow-100">
                            <div class="flex justify-between font-black text-yellow-700 mb-1"><span>Ù…Ù‡ / Whiteout</span><span class="dir-ltr">50-80%</span></div>
                            <p class="opacity-70">Ù„Ù†Ø² Ø²Ø±Ø¯ Ù‚ÙˆÛŒ. Ø­Ø¯Ø§Ú©Ø«Ø± Ú©Ù†ØªØ±Ø§Ø³Øª.</p>
                        </div>
                    </div>
                </div>
            </div>
        </section>

    </main>

    <!-- Footer -->
    <footer class="w-full py-10 text-center text-xs opacity-60 border-t border-current/5 bg-current/5">
        <p class="font-mono dir-ltr mb-2 font-bold">Barf Ko v2.2</p>
        <p>Ø·Ø±Ø§Ø­ÛŒ Ø´Ø¯Ù‡ Ø¨Ø§ â¤ï¸ Ø¨Ø±Ø§ÛŒ Ø¬Ø§Ù…Ø¹Ù‡ Ø§Ø³Ú©ÛŒ Ø§ÛŒØ±Ø§Ù†</p>
    </footer>

    <!-- Logic -->
    <script>
        // --- 1. Configuration & Data ---
        const RESORTS = {
            tochal: {
                id: 'tochal',
                name: 'Ù¾ÛŒØ³Øª Ø¨ÛŒÙ†â€ŒØ§Ù„Ù…Ù„Ù„ÛŒ ØªÙˆÚ†Ø§Ù„',
                locations: [
                    { name: 'Ø§ÛŒØ³ØªÚ¯Ø§Ù‡ Û· (Ù‚Ù„Ù‡)', alt: '3740m', lat: 35.8853, lon: 51.4150 },
                    { name: 'Ø§ÛŒØ³ØªÚ¯Ø§Ù‡ Ûµ', alt: '2935m', lat: 35.8600, lon: 51.4080 },
                    { name: 'Ø§ÛŒØ³ØªÚ¯Ø§Ù‡ Û±', alt: '1900m', lat: 35.8195, lon: 51.4100 }
                ]
            },
            dizin: {
                id: 'dizin',
                name: 'Ù¾ÛŒØ³Øª Ø¨ÛŒÙ†â€ŒØ§Ù„Ù…Ù„Ù„ÛŒ Ø¯ÛŒØ²ÛŒÙ†',
                locations: [
                    { name: 'Ù‚Ù„Ù‡ (Ø³ÛŒâ€ŒÚ†Ø§Ù„)', alt: '3600m', lat: 36.0540, lon: 51.4180 },
                    { name: 'Ù¾Ø§Ø±Ú©ÛŒÙ†Ú¯ Ø¨Ø§Ù„Ø§', alt: '3000m', lat: 36.0460, lon: 51.4150 },
                    { name: 'Ù¾Ø§ÛŒÛŒÙ† (Ù‡ØªÙ„)', alt: '2650m', lat: 36.0350, lon: 51.4100 }
                ]
            },
            darbandsar: {
                id: 'darbandsar',
                name: 'Ù¾ÛŒØ³Øª Ø§Ø³Ú©ÛŒ Ø¯Ø±Ø¨Ù†Ø¯Ø³Ø±',
                locations: [
                    { name: 'Ù‚Ù„Ù‡', alt: '3570m', lat: 36.0180, lon: 51.4650 },
                    { name: 'Ù…ÛŒØ§Ù†â€ŒØ±Ø§Ù‡', alt: '3000m', lat: 36.0150, lon: 51.4600 },
                    { name: 'Ù¾Ø§ÛŒÛŒÙ†', alt: '2600m', lat: 36.0100, lon: 51.4550 }
                ]
            },
            shemshak: {
                id: 'shemshak',
                name: 'Ù¾ÛŒØ³Øª Ø§Ø³Ú©ÛŒ Ø´Ù…Ø´Ú©',
                locations: [
                    { name: 'Ù‚Ù„Ù‡', alt: '3050m', lat: 36.0220, lon: 51.4890 },
                    { name: 'Ø¢ÙØªØ§Ø¨ (Ù…ÛŒØ§Ù†ÛŒ)', alt: '2550m', lat: 36.0150, lon: 51.4950 },
                    { name: 'Ø´Ø¨ (Ù¾Ø§ÛŒÛŒÙ†)', alt: '2550m', lat: 36.0100, lon: 51.4900 }
                ]
            }
        };

        const weatherStore = {};
        let currentSelection = 'tochal';
        let selectedDayIndex = 0;

        // --- 2. Analysis Engine ---
        
        function analyzeConditions(data) {
            const wind = data.wind;
            const windGust = data.windGust || wind * 1.5;
            const vis = data.vis;
            const cloud = data.cloud;
            const temp = data.temp;
            const cape = data.cape || 0;
            const liftedIndex = data.liftedIndex || 0;
            const isDay = data.isDay;
            const freezeLvl = data.freezeLvl;
            const stationAlt = parseInt(data.alt) || 3000;
            const uv = data.uv || 0;
            const precipitation = data.precipitation || 0;
            const humidity = data.humidity || 0;

            // Wind Analysis
            let windCond, windRec, liftStatus;
            let windRiskLevel = 0;

            if (wind <= 10) {
                windCond = "Ø§ÛŒØ¯Ù‡â€ŒØ¢Ù„ (Ø¢Ø±Ø§Ù…)";
                windRec = "Ø´Ø±Ø§ÛŒØ· ÙÙ†ÛŒ Ø¹Ø§Ù„ÛŒ. Ø¨Ø±Ù Ø¨Ø¯ÙˆÙ† ØªØºÛŒÛŒØ±.";
                liftStatus = "ØªÙ…Ø§Ù… Ù„ÛŒÙØªâ€ŒÙ‡Ø§ Ø¨Ø§Ø²";
            } else if (wind <= 20) {
                windCond = "Ú©Ù…ÛŒ Ù…Ø­Ø³ÙˆØ³";
                windRec = "Ú©Ù…ÛŒ Ø¬Ø§Ø¨Ù‡â€ŒØ¬Ø§ÛŒÛŒ Ù¾ÙˆØ¯Ø± Ø¨Ø±Ù.";
                liftStatus = "ØªÙ…Ø§Ù… Ù„ÛŒÙØªâ€ŒÙ‡Ø§ Ø¨Ø§Ø²";
            } else if (wind <= 30) {
                windCond = "ØªØºÛŒÛŒØ± Ø¯Ø± Ú©Ù†ØªØ±Ù„";
                windRec = "Ø¨Ø±Ù Ø¨Ø§Ø¯Ø®ÙˆØ±Ø¯Ù‡ (Wind-drift).";
                liftStatus = "Ø¨Ø§Ø² (ØªØ­Øª Ù†Ø¸Ø§Ø±Øª)";
            } else if (wind <= 40) {
                windCond = "Ù…Ø´Ú©Ù„ Ù„Ø¨Ù‡â€ŒÚ¯ÛŒØ±ÛŒ";
                windRec = "ÛŒØ®â€ŒØ²Ø§ÛŒÛŒ Ø³Ø·Ø­ÛŒ. Ú©Ø§Ù‡Ø´ Ø¯ÛŒØ¯.";
                liftStatus = "Ø§Ø­ØªÙ…Ø§Ù„ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª";
                windRiskLevel = 1;
            } else if (wind <= 50) {
                windCond = "Ø±ÛŒØ³Ú© Ø¨Ø§Ù„Ø§";
                windRec = "Ø¨Ø±Ù Ø³ÙØª/ÛŒØ®â€ŒØ²Ø¯Ù‡. Ú©Ù†ØªØ±Ù„ Ø³Ø®Øª.";
                liftStatus = "ØªÙ„Ù‡â€ŒØ³ÛŒÚ˜Ù‡Ø§ ØºØ§Ù„Ø¨Ø§Ù‹ Ø¨Ø³ØªÙ‡";
                windRiskLevel = 2;
            } else if (wind <= 60) {
                windCond = "Ø®Ø·Ø±Ù†Ø§Ú©";
                windRec = "Whiteout. ØªØ¹Ø§Ø¯Ù„ Ø¯Ø´ÙˆØ§Ø±.";
                liftStatus = "ÙÙ‚Ø· Ú©Ø§Ø¨ÛŒÙ† (Ø§Ø­ØªÛŒØ§Ø·)";
                windRiskLevel = 2;
            } else {
                windCond = "Ø·ÙˆÙØ§Ù† / Ø¨Ø³ÛŒØ§Ø± Ø®Ø·Ø±Ù†Ø§Ú©";
                windRec = "Ø´Ø±Ø§ÛŒØ· ØºÛŒØ±Ù‚Ø§Ø¨Ù„ Ø§Ø³Ú©ÛŒ.";
                liftStatus = "ØªØ¹Ø·ÛŒÙ„ÛŒ Ú©Ø§Ù…Ù„";
                windRiskLevel = 3;
            }

            // Lens Analysis
            let lensCond, lensRec, lensVLT;
            if (isDay === 0) {
                lensCond = "Ø´Ø¨ / Ù†ÙˆØ± Ù…ØµÙ†ÙˆØ¹ÛŒ";
                lensRec = "Ù„Ù†Ø² Ø´ÙØ§Ù (Clear).";
                lensVLT = "80-95%";
            } else if (vis < 500 || (cloud > 90 && wind > 40)) {
                lensCond = "Ù…Ù‡ Ø³Ù†Ú¯ÛŒÙ† / Whiteout";
                lensRec = "Ø²Ø±Ø¯ Ù‚ÙˆÛŒ / ØµÙˆØ±ØªÛŒ Ø±ÙˆØ´Ù†.";
                lensVLT = "50-80%";
            } else if (cloud > 75) {
                lensCond = "Ø§Ø¨Ø±ÛŒ / Flat-Light";
                lensRec = "Ø²Ø±Ø¯ / Ù†Ø§Ø±Ù†Ø¬ÛŒ Ø±ÙˆØ´Ù† / Rose.";
                lensVLT = "35-60%";
            } else if (cloud > 40) {
                lensCond = "Ù†ÛŒÙ…Ù‡ Ø§Ø¨Ø±ÛŒ / Ù…ØªØºÛŒØ±";
                lensRec = "Ù†Ø§Ø±Ù†Ø¬ÛŒ / Ø±Ø² / Ú©Ø§Ù¾Ø±.";
                lensVLT = "18-35%";
            } else if (cloud > 15) {
                lensCond = "Ø¢ÙØªØ§Ø¨ÛŒ Ù…ØªÙˆØ³Ø·";
                lensRec = "Ø¨Ø±Ù†Ø²ÛŒ / Ù‚Ù‡ÙˆÙ‡â€ŒØ§ÛŒ.";
                lensVLT = "10-25%";
            } else {
                lensCond = "Ø¢ÙØªØ§Ø¨ÛŒ Ø´Ø¯ÛŒØ¯";
                lensRec = "Ø®Ø§Ú©Ø³ØªØ±ÛŒ / Ù…Ø´Ú©ÛŒ / Ø¢ÛŒÙ†Ù‡â€ŒØ§ÛŒ.";
                lensVLT = "5-10%";
            }

            // CAPE + LI Combined Analysis (New Scenario Table)
            let capeCond, capeRec, liCond, skiResult;
            let capeRiskLevel = 0;
            
            if (cape <= 100 && liftedIndex >= 0) {
                capeCond = "Ù¾Ø§ÛŒØ¯Ø§Ø±";
                capeRec = "CIN Ù…Ø«Ø¨Øª";
                liCond = "Ù¾Ø§ÛŒØ¯Ø§Ø±";
                skiResult = "Ø¨Ù‡ØªØ±ÛŒÙ† Ø²Ù…Ø§Ù† ØµØ¹ÙˆØ¯";
                capeRiskLevel = 0;
            } else if (cape <= 500 && liftedIndex >= -3) {
                capeCond = "Ù†Ø§Ù¾Ø§ÛŒØ¯Ø§Ø±ÛŒ Ú©Ù…";
                capeRec = "CIN Ù…Ù…Ú©Ù† Ø§Ø³Øª Ø¨Ø´Ú©Ù†Ø¯";
                liCond = "Ù†ÛŒÙ…Ù‡ Ù¾Ø§ÛŒØ¯Ø§Ø±";
                skiResult = "Ø§Ù…Ú©Ø§Ù† Ø±Ú¯Ø¨Ø§Ø± Ù†Ø§Ú¯Ù‡Ø§Ù†ÛŒ â€“ Ø§Ø­ØªÛŒØ§Ø·";
                capeRiskLevel = 1;
            } else if (cape <= 1000 && liftedIndex >= -5) {
                capeCond = "Ø±Ø¹Ø¯ÙˆØ¨Ø±Ù‚ Ù¾Ø±Ø§Ú©Ù†Ø¯Ù‡";
                capeRec = "CIN Ø¯Ø± Ø­Ø§Ù„ Ø´Ú©Ø³Øª";
                liCond = "Ù†Ø§Ù¾Ø§ÛŒØ¯Ø§Ø± Ù…ØªÙˆØ³Ø·";
                skiResult = "Ø®Ø·Ø± Ù…ØªÙˆØ³Ø·";
                capeRiskLevel = 2;
            } else if (cape <= 2500 && liftedIndex >= -6) {
                capeCond = "ØªÙˆÙØ§Ù† Ù‚ÙˆÛŒ";
                capeRec = "CIN Ø´Ú©Ø³ØªÙ‡";
                liCond = "Ù†Ø§Ù¾Ø§ÛŒØ¯Ø§Ø± Ø´Ø¯ÛŒØ¯";
                skiResult = "ØµØ¹ÙˆØ¯ Ù…Ù…Ù†ÙˆØ¹!";
                capeRiskLevel = 3;
            } else {
                capeCond = "Supercell";
                capeRec = "CIN ØªÙ‚Ø±ÛŒØ¨Ø§Ù‹ ØµÙØ±";
                liCond = "Ø¨Ø³ÛŒØ§Ø± Ù†Ø§Ù¾Ø§ÛŒØ¯Ø§Ø±";
                skiResult = "Ù¾ÛŒØ³Øª Ø¨Ø§ÛŒØ¯ Ø¨Ø³ØªÙ‡ Ø´ÙˆØ¯!";
                capeRiskLevel = 4;
            }

            // Freezing Level Analysis
            let surfaceCond = "Ù†Ø±Ù…Ø§Ù„";
            if (freezeLvl > stationAlt + 200) surfaceCond = "Ø¨Ø±Ù Ø¢Ø¨Ú©ÛŒ (Slush)";
            else if (freezeLvl < stationAlt - 500) surfaceCond = "Ù¾ÙˆØ¯Ø± Ø®Ø´Ú© (Dry Powder)";
            else surfaceCond = "Ù…ØªØºÛŒØ± / ÛŒØ®â€ŒØ²Ø¯Ù‡";

            // Visibility Analysis
            let visCond;
            if (vis > 10000) visCond = "Ø¹Ø§Ù„ÛŒ";
            else if (vis > 5000) visCond = "Ø®ÙˆØ¨";
            else if (vis > 2000) visCond = "Ù…ØªÙˆØ³Ø·";
            else if (vis > 1000) visCond = "Ø¶Ø¹ÛŒÙ";
            else visCond = "Ø¨Ø³ÛŒØ§Ø± Ø¶Ø¹ÛŒÙ";

            // Final Decision
            let status = "GO";
            let statusText = "ÙˆØ¶Ø¹ÛŒØª Ù…Ø³Ø§Ø¹Ø¯";
            let statusColor = "text-green-600";
            let lightColor = "bg-green-500";
            let reasons = [];

            if (windRiskLevel === 3 || vis < 200 || capeRiskLevel >= 3) {
                status = "NO-GO";
                statusText = "Ø®Ø·Ø±Ù†Ø§Ú© / Ù…Ù…Ù†ÙˆØ¹";
                statusColor = "text-red-600";
                lightColor = "bg-red-500";
                if(windRiskLevel === 3) reasons.push(`Ø¨Ø§Ø¯ Ø¨Ø³ÛŒØ§Ø± Ø´Ø¯ÛŒØ¯ (${wind} km/h)`);
                if(vis < 200) reasons.push("Ø¯ÛŒØ¯ Ø§ÙÙ‚ÛŒ Ù†Ø§Ú©Ø§ÙÛŒ (<200m)");
                if(capeRiskLevel >= 3) reasons.push(`${capeCond} (CAPE: ${Math.round(cape)})`);
            } else if (windRiskLevel >= 1 || vis < 1000 || capeRiskLevel >= 1 || uv > 8) {
                status = "CAUTION";
                statusText = "Ø§Ø­ØªÛŒØ§Ø· Ú©Ù†ÛŒØ¯";
                statusColor = "text-amber-600";
                lightColor = "bg-amber-500";
                if(windRiskLevel >= 1) reasons.push(`Ø¨Ø§Ø¯ Ù‚Ø§Ø¨Ù„ ØªÙˆØ¬Ù‡ (${wind} km/h)`);
                if(vis < 1000) reasons.push("Ú©Ø§Ù‡Ø´ Ø¯ÛŒØ¯ Ø§ÙÙ‚ÛŒ");
                if(capeRiskLevel >= 1) reasons.push("Ù†Ø§Ù¾Ø§ÛŒØ¯Ø§Ø±ÛŒ Ø¬ÙˆÛŒ");
                if(uv > 8) reasons.push("Ø§Ø´Ø¹Ù‡ ÙØ±Ø§Ø¨Ù†ÙØ´ Ø¨Ø³ÛŒØ§Ø± Ø²ÛŒØ§Ø¯");
            }

            return {
                status, statusText, statusColor, lightColor, reasons,
                wind: { val: wind, gust: Math.round(windGust), cond: windCond, rec: windRec, lift: liftStatus },
                lens: { cond: lensCond, rec: lensRec, vlt: lensVLT },
                cape: { val: Math.round(cape), cond: capeCond, rec: capeRec, skiResult: skiResult },
                liftedIndex: { val: Math.round(liftedIndex * 10) / 10, cond: liCond, skiResult: skiResult },
                surface: { val: surfaceCond, freezeLvl: Math.round(freezeLvl) },
                visibility: { val: (vis / 1000).toFixed(1), cond: visCond },
                uv: { val: uv, cond: uv > 6 ? "Ø²ÛŒØ§Ø¯ (Ø®Ø·Ø± Ø¢ÙØªØ§Ø¨â€ŒØ³ÙˆØ®ØªÚ¯ÛŒ)" : "Ù†Ø±Ù…Ø§Ù„" },
                precipitation: { val: precipitation },
                humidity: { val: humidity },
                cloudCover: { val: cloud },
                realFeel: Math.round(13.12 + 0.6215 * temp - 11.37 * Math.pow(wind, 0.16) + 0.3965 * temp * Math.pow(wind, 0.16))
            };
        }

        // --- 3. API Interaction ---
        
        async function fetchWeather(lat, lon) {
            const url = `https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current=temperature_2m,relative_humidity_2m&daily=weather_code,temperature_2m_max,temperature_2m_min,snowfall_sum,precipitation_probability_max,precipitation_sum,uv_index_max&hourly=temperature_2m,relative_humidity_2m,weather_code,wind_speed_10m,wind_gusts_10m,is_day,visibility,cloud_cover,snowfall,precipitation,cape,lifted_index,freezing_level_height&forecast_days=16&timezone=Asia%2FTehran`;
            try {
                const res = await fetch(url);
                if(!res.ok) throw new Error("API Error");
                return await res.json();
            } catch (e) { 
                console.error(e);
                return null; 
            }
        }

        function getPersianDate(offset) {
            const d = new Date();
            d.setDate(d.getDate() + offset);
            const days = ['ÛŒÚ©Ø´Ù†Ø¨Ù‡', 'Ø¯ÙˆØ´Ù†Ø¨Ù‡', 'Ø³Ù‡â€ŒØ´Ù†Ø¨Ù‡', 'Ú†Ù‡Ø§Ø±Ø´Ù†Ø¨Ù‡', 'Ù¾Ù†Ø¬Ø´Ù†Ø¨Ù‡', 'Ø¬Ù…Ø¹Ù‡', 'Ø´Ù†Ø¨Ù‡'];
            return {
                day: offset === 0 ? 'Ø§Ù…Ø±ÙˆØ²' : (offset === 1 ? 'ÙØ±Ø¯Ø§' : days[d.getDay()]),
                full: new Intl.DateTimeFormat('fa-IR', { day: 'numeric', month: 'long' }).format(d)
            };
        }

        // --- 4. Rendering Logic ---

        async function loadResort(key) {
            currentSelection = key;
            selectedDayIndex = 0;
            
            // Clear prediction result when resort changes
            const predictionResult = document.getElementById('prediction-result');
            predictionResult.innerHTML = '';
            predictionResult.classList.add('hidden');
            
            document.querySelectorAll('.resort-btn').forEach(b => {
                b.classList.remove('accent-bg', 'text-white', 'shadow-lg', 'opacity-100');
                b.classList.add('hover:bg-current/5', 'opacity-70');
            });
            document.getElementById(`btn-${key}`).classList.add('accent-bg', 'text-white', 'shadow-lg', 'opacity-100');
            document.getElementById(`btn-${key}`).classList.remove('hover:bg-current/5', 'opacity-70');
            
            const container = document.getElementById('content-area');
            container.innerHTML = '';
            document.getElementById('loading').classList.replace('hidden','flex');
            
            const resort = RESORTS[key];
            container.innerHTML = `
                <div>
                    <h2 class="text-3xl font-black mb-8 text-center md:text-right flex items-center gap-3 justify-center md:justify-start">
                        ${resort.name}
                        <span class="text-xs bg-current/5 px-3 py-1 rounded-full opacity-60">Û³ Ø§Ø±ØªÙØ§Ø¹</span>
                    </h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8" id="cards-container"></div>
                </div>
            `;
            
            renderDateSelector();
            await loadCards(key);
            
            document.getElementById('loading').classList.replace('flex','hidden');
        }

        async function loadCards(resortKey) {
            const container = document.getElementById('cards-container');
            const resort = RESORTS[resortKey];
            
            if(!weatherStore[resortKey]) {
                const promises = resort.locations.map(l => fetchWeather(l.lat, l.lon));
                const data = await Promise.all(promises);
                weatherStore[resortKey] = data;
            }

            container.innerHTML = '';
            weatherStore[resortKey].forEach((data, idx) => {
                if(data) container.innerHTML += createCard(resort.locations[idx], data, idx, resortKey);
                else container.innerHTML += `<div class="glass-card p-6 rounded-3xl text-center text-red-500 font-bold">Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ø§Ø·Ù„Ø§Ø¹Ø§Øª</div>`;
            });
            lucide.createIcons();
        }

        function createCard(loc, data, locIdx, resortKey) {
            const daily = data.daily;
            const h = data.hourly;
            const hourIdx = (selectedDayIndex * 24) + 12;

            const mainTemp = selectedDayIndex === 0 ? Math.round(data.current.temperature_2m) : Math.round(daily.temperature_2m_max[selectedDayIndex]);
            
            const getVal = (arr, i, def) => (arr && arr[i] !== undefined) ? arr[i] : def;

            const analysis = analyzeConditions({
                temp: getVal(h.temperature_2m, hourIdx, 0),
                wind: getVal(h.wind_speed_10m, hourIdx, 0),
                windGust: getVal(h.wind_gusts_10m, hourIdx, 0),
                vis: getVal(h.visibility, hourIdx, 10000),
                cloud: getVal(h.cloud_cover, hourIdx, 0),
                cape: getVal(h.cape, hourIdx, 0),
                liftedIndex: getVal(h.lifted_index, hourIdx, 0),
                freezeLvl: getVal(h.freezing_level_height, hourIdx, 3000),
                uv: getVal(daily.uv_index_max, selectedDayIndex, 0),
                precipitation: getVal(h.precipitation, hourIdx, 0),
                humidity: getVal(h.relative_humidity_2m, hourIdx, 0),
                alt: loc.alt,
                isDay: getVal(h.is_day, hourIdx, 1)
            });

            let iconName = "check-circle-2";
            if(analysis.status === "CAUTION") iconName = "alert-triangle";
            if(analysis.status === "NO-GO") iconName = "ban";

            return `
                <div class="glass-card rounded-[2.5rem] overflow-hidden flex flex-col h-full group hover:scale-[1.01] transition-transform duration-500">
                    
                    <!-- Status Header with Traffic Light -->
                    <div class="px-5 py-4 flex justify-between items-center bg-white/50 border-b border-current/5">
                        <div class="flex items-center gap-3">
                            <div class="w-4 h-4 rounded-full ${analysis.lightColor} shadow-lg shadow-current/30 animate-pulse"></div>
                            <span class="font-black text-xs ${analysis.statusColor}">${analysis.statusText}</span>
                        </div>
                        <span class="font-mono dir-ltr text-[10px] font-bold opacity-60 bg-current/10 px-2 py-0.5 rounded-full">${loc.alt}</span>
                    </div>

                    <!-- Main Info -->
                    <div class="p-4 text-center relative">
                        <h3 class="text-sm font-bold opacity-60 mb-1">${loc.name}</h3>
                        <div class="flex justify-center items-end gap-1 leading-none mb-2">
                            <span class="text-5xl font-black dir-ltr tracking-tighter text-current drop-shadow-sm">${mainTemp}Â°</span>
                        </div>
                        <div class="flex justify-center gap-3 text-[10px] font-bold opacity-50 dir-ltr mb-2">
                            <span>L: ${Math.round(daily.temperature_2m_min[selectedDayIndex])}Â°</span>
                            <span class="w-px h-3 bg-current/20"></span>
                            <span>H: ${Math.round(daily.temperature_2m_max[selectedDayIndex])}Â°</span>
                        </div>
                        <div class="inline-flex items-center gap-1.5 bg-current/5 px-2 py-1 rounded-lg text-[10px] font-bold opacity-80">
                            <i data-lucide="thermometer" class="w-2.5 h-2.5"></i>
                            <span>Real Feel: <span class="dir-ltr">${analysis.realFeel}Â°</span></span>
                        </div>
                        ${analysis.uv.val > 6 ? `<div class="mt-1 text-[9px] text-red-500 font-bold animate-pulse">âš ï¸ Ø®Ø·Ø± UV Ø¨Ø§Ù„Ø§!</div>` : ''}
                    </div>

                    <!-- Basic Stats Grid -->
                    <div class="grid grid-cols-4 gap-px bg-current/5 border-y border-current/5">
                        <div class="bg-white/40 p-2.5 flex flex-col items-center gap-0.5">
                            <i data-lucide="wind" class="w-3 h-3 opacity-50"></i>
                            <span class="text-sm font-black dir-ltr text-blue-600">${analysis.wind.val}</span>
                            <span class="text-[8px] opacity-60">Ø¨Ø§Ø¯</span>
                        </div>
                        <div class="bg-white/40 p-2.5 flex flex-col items-center gap-0.5">
                            <i data-lucide="eye" class="w-3 h-3 opacity-50"></i>
                            <span class="text-sm font-black dir-ltr">${analysis.visibility.val}</span>
                            <span class="text-[8px] opacity-60">Ø¯ÛŒØ¯</span>
                        </div>
                        <div class="bg-white/40 p-2.5 flex flex-col items-center gap-0.5">
                            <i data-lucide="droplets" class="w-3 h-3 opacity-50"></i>
                            <span class="text-sm font-black dir-ltr text-cyan-600">${analysis.humidity.val}%</span>
                            <span class="text-[8px] opacity-60">Ø±Ø·ÙˆØ¨Øª</span>
                        </div>
                        <div class="bg-white/40 p-2.5 flex flex-col items-center gap-0.5">
                            <i data-lucide="cloud" class="w-3 h-3 opacity-50"></i>
                            <span class="text-sm font-black dir-ltr text-gray-600">${analysis.cloudCover.val}%</span>
                            <span class="text-[8px] opacity-60">Ø§Ø¨Ø±</span>
                        </div>
                    </div>

                    <!-- Detailed Analysis -->
                    <div class="p-3 space-y-2 flex-grow">
                        
                        <!-- Wind Analysis -->
                        <div class="bg-blue-50/50 rounded-xl p-2.5 flex items-center justify-between">
                            <div class="flex items-center gap-2">
                                <div class="w-7 h-7 rounded-lg bg-blue-100 flex items-center justify-center">
                                    <i data-lucide="wind" class="w-3.5 h-3.5 text-blue-600"></i>
                                </div>
                                <div>
                                    <div class="text-[10px] font-bold text-blue-800">${analysis.wind.cond}</div>
                                    <div class="text-[8px] opacity-60">${analysis.wind.lift}</div>
                                </div>
                            </div>
                            <div class="text-left dir-ltr">
                                <div class="text-xs font-black text-blue-600">${analysis.wind.val} km/h</div>
                                <div class="text-[8px] opacity-50">Gust: ${analysis.wind.gust}</div>
                            </div>
                        </div>

                        <!-- Lens Recommendation -->
                        <div class="bg-amber-50/50 rounded-xl p-2.5 flex items-center justify-between">
                            <div class="flex items-center gap-2">
                                <div class="w-7 h-7 rounded-lg bg-amber-100 flex items-center justify-center">
                                    <i data-lucide="glasses" class="w-3.5 h-3.5 text-amber-600"></i>
                                </div>
                                <div>
                                    <div class="text-[10px] font-bold text-amber-800">${analysis.lens.cond}</div>
                                    <div class="text-[8px] opacity-60">${analysis.lens.rec}</div>
                                </div>
                            </div>
                            <div class="text-left">
                                <div class="text-xs font-black text-amber-600 dir-ltr">${analysis.lens.vlt}</div>
                                <div class="text-[8px] opacity-50">VLT</div>
                            </div>
                        </div>

                        <!-- Snow Quality -->
                        <div class="bg-teal-50/50 rounded-xl p-2.5 flex items-center justify-between">
                            <div class="flex items-center gap-2">
                                <div class="w-7 h-7 rounded-lg bg-teal-100 flex items-center justify-center">
                                    <i data-lucide="snowflake" class="w-3.5 h-3.5 text-teal-600"></i>
                                </div>
                                <div>
                                    <div class="text-[10px] font-bold text-teal-800">${analysis.surface.val}</div>
                                    <div class="text-[8px] opacity-60">Ø¨Ø§Ø±Ø´: ${analysis.precipitation.val} mm</div>
                                </div>
                            </div>
                            <div class="text-left dir-ltr">
                                <div class="text-xs font-black text-teal-600">${analysis.surface.freezeLvl}m</div>
                                <div class="text-[8px] opacity-50">Freeze Lvl</div>
                            </div>
                        </div>

                        <!-- CAPE / Stability -->
                        <div class="bg-purple-50/50 rounded-xl p-2.5">
                            <div class="flex items-center justify-between mb-1.5">
                                <div class="flex items-center gap-2">
                                    <div class="w-7 h-7 rounded-lg bg-purple-100 flex items-center justify-center">
                                        <i data-lucide="zap" class="w-3.5 h-3.5 text-purple-600"></i>
                                    </div>
                                    <div>
                                        <div class="text-[10px] font-bold text-purple-800">${analysis.cape.cond}</div>
                                        <div class="text-[8px] opacity-60">${analysis.cape.rec}</div>
                                    </div>
                                </div>
                                <div class="text-left dir-ltr">
                                    <div class="text-xs font-black text-purple-600">${analysis.cape.val}</div>
                                    <div class="text-[8px] opacity-50">CAPE J/kg</div>
                                </div>
                            </div>
                            <div class="bg-purple-100/50 rounded-lg px-2 py-1 text-center">
                                <span class="text-[9px] font-bold text-purple-700">ğŸ¿ ${analysis.cape.skiResult}</span>
                            </div>
                        </div>

                        <!-- Lifted Index -->
                        <div class="bg-rose-50/50 rounded-xl p-2.5">
                            <div class="flex items-center justify-between mb-1.5">
                                <div class="flex items-center gap-2">
                                    <div class="w-7 h-7 rounded-lg bg-rose-100 flex items-center justify-center">
                                        <i data-lucide="arrow-up-down" class="w-3.5 h-3.5 text-rose-600"></i>
                                    </div>
                                    <div>
                                        <div class="text-[10px] font-bold text-rose-800">${analysis.liftedIndex.cond}</div>
                                        <div class="text-[8px] opacity-60">Ø´Ø§Ø®Øµ Ø¨Ù„Ù†Ø¯Ø´Ø¯Ú¯ÛŒ</div>
                                    </div>
                                </div>
                                <div class="text-left dir-ltr">
                                    <div class="text-xs font-black text-rose-600">${analysis.liftedIndex.val}Â°</div>
                                    <div class="text-[8px] opacity-50">LI</div>
                                </div>
                            </div>
                            <div class="bg-rose-100/50 rounded-lg px-2 py-1 text-center">
                                <span class="text-[9px] font-bold text-rose-700">ğŸ¿ ${analysis.liftedIndex.skiResult}</span>
                            </div>
                        </div>
                    </div>

                    <!-- Reasons Footer (if any) -->
                    ${analysis.reasons.length > 0 ? `
                    <div class="px-3 pb-3">
                        <div class="bg-current/5 rounded-xl p-2.5 text-center">
                            <div class="text-[9px] font-bold opacity-70">âš ï¸ ${analysis.reasons.join(' â€¢ ')}</div>
                        </div>
                    </div>
                    ` : ''}
                </div>
            `;
        }

        function openDetail(rKey, lIdx) {
            const data = weatherStore[rKey][lIdx];
            const h = data.hourly;
            const hourIdx = (selectedDayIndex * 24) + 12;
            const getVal = (arr, i, def) => (arr && arr[i] !== undefined) ? arr[i] : def;

            const analysis = analyzeConditions({
                temp: getVal(h.temperature_2m, hourIdx, 0),
                wind: getVal(h.wind_speed_10m, hourIdx, 0),
                windGust: getVal(h.wind_gusts_10m, hourIdx, 0),
                vis: getVal(h.visibility, hourIdx, 10000),
                cloud: getVal(h.cloud_cover, hourIdx, 0),
                cape: getVal(h.cape, hourIdx, 0),
                liftedIndex: getVal(h.lifted_index, hourIdx, 0),
                freezeLvl: getVal(h.freezing_level_height, hourIdx, 3000),
                uv: getVal(data.daily.uv_index_max, selectedDayIndex, 0),
                precipitation: getVal(h.precipitation, hourIdx, 0),
                humidity: getVal(h.relative_humidity_2m, hourIdx, 0),
                alt: RESORTS[rKey].locations[lIdx].alt,
                isDay: getVal(h.is_day, hourIdx, 1)
            });

            const modal = document.getElementById('hourly-modal');
            const content = document.getElementById('modal-content');
            document.getElementById('modal-title').innerText = RESORTS[rKey].locations[lIdx].name;
            document.getElementById('modal-subtitle').innerText = `${analysis.statusText} - ${getPersianDate(selectedDayIndex).full}`;

            content.innerHTML = `
                <!-- Status Banner -->
                <div class="${analysis.statusColor} p-6 rounded-3xl flex items-start gap-4 shadow-sm">
                    <div class="p-3 bg-white/50 rounded-full shadow-sm"><i data-lucide="${analysis.status === 'GO' ? 'check' : 'alert-triangle'}" class="w-8 h-8"></i></div>
                    <div>
                        <h3 class="text-xl font-black mb-2">${analysis.statusText}</h3>
                        <p class="text-sm opacity-90 leading-relaxed font-medium">
                            ${analysis.reasons.length > 0 ? 'Ø¹Ù„Øª: ' + analysis.reasons.join(' + ') : 'ØªÙ…Ø§Ù…ÛŒ Ø´Ø§Ø®Øµâ€ŒÙ‡Ø§ÛŒ Ø¬ÙˆÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø³Ú©ÛŒ Ù…Ø³Ø§Ø¹Ø¯ Ù‡Ø³ØªÙ†Ø¯.'}
                        </p>
                    </div>
                </div>

                <!-- Analysis Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    
                    <!-- Wind -->
                    <div class="glass-card p-5 rounded-3xl border-0 bg-blue-50/50">
                        <div class="flex justify-between mb-3 items-start">
                            <div>
                                <strong class="text-blue-800 flex items-center gap-2 text-sm mb-1"><i data-lucide="wind" class="w-4 h-4"></i> ÙˆØ¶Ø¹ÛŒØª Ø¨Ø§Ø¯</strong>
                                <p class="text-sm font-bold text-blue-900">${analysis.wind.cond}</p>
                            </div>
                            <div class="text-right">
                                <div class="dir-ltr font-black text-2xl text-blue-600">${analysis.wind.val}</div>
                                <div class="text-[10px] opacity-60 dir-ltr">Gust: ${analysis.wind.gust} km/h</div>
                            </div>
                        </div>
                        <p class="text-xs text-blue-800/70 leading-relaxed mb-3">${analysis.wind.rec}</p>
                        <div class="bg-white/60 px-3 py-1.5 rounded-lg text-xs text-blue-900 font-bold inline-block shadow-sm">
                            ${analysis.wind.lift}
                        </div>
                    </div>

                    <!-- Visibility -->
                    <div class="glass-card p-5 rounded-3xl border-0 bg-slate-50/50">
                        <div class="flex justify-between mb-3 items-start">
                            <div>
                                <strong class="text-slate-800 flex items-center gap-2 text-sm mb-1"><i data-lucide="eye" class="w-4 h-4"></i> Ø¯ÛŒØ¯ Ùˆ Ø§Ø¨Ø±</strong>
                                <p class="text-sm font-bold text-slate-900">${analysis.visibility.cond}</p>
                            </div>
                            <div class="text-right">
                                <div class="dir-ltr font-black text-2xl text-slate-600">${analysis.visibility.val}</div>
                                <div class="text-[10px] opacity-60">Ú©ÛŒÙ„ÙˆÙ…ØªØ±</div>
                            </div>
                        </div>
                        <div class="flex gap-4 text-xs">
                            <div class="flex-1 bg-white/60 p-2 rounded-lg">
                                <div class="opacity-60 mb-1">Ù¾ÙˆØ´Ø´ Ø§Ø¨Ø±</div>
                                <div class="font-black dir-ltr">${analysis.cloudCover.val}%</div>
                            </div>
                            <div class="flex-1 bg-white/60 p-2 rounded-lg">
                                <div class="opacity-60 mb-1">Ø±Ø·ÙˆØ¨Øª</div>
                                <div class="font-black dir-ltr">${analysis.humidity.val}%</div>
                            </div>
                        </div>
                    </div>

                    <!-- Lens/Light -->
                    <div class="glass-card p-5 rounded-3xl border-0 bg-amber-50/50">
                        <div class="flex justify-between mb-3 items-start">
                            <div>
                                <strong class="text-amber-800 flex items-center gap-2 text-sm mb-1"><i data-lucide="glasses" class="w-4 h-4"></i> Ù„Ù†Ø² Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯ÛŒ</strong>
                                <p class="text-sm font-bold text-amber-900">${analysis.lens.cond}</p>
                            </div>
                            <div class="text-right">
                                <div class="dir-ltr font-black text-2xl text-amber-600">${analysis.lens.vlt.replace('%','')}</div>
                                <div class="text-[10px] opacity-60">VLT</div>
                            </div>
                        </div>
                        <p class="text-xs text-amber-800/70 leading-relaxed mb-2">Ù¾ÛŒØ´Ù†Ù‡Ø§Ø¯: ${analysis.lens.rec}</p>
                        ${analysis.uv.val > 6 ? `<div class="mt-2 text-xs text-red-600 font-bold bg-red-100/50 px-2 py-1 rounded inline-block">UV Index: ${analysis.uv.val} (Ø¨Ø§Ù„Ø§)</div>` : ''}
                    </div>

                    <!-- Surface/Snow -->
                    <div class="glass-card p-5 rounded-3xl border-0 bg-teal-50/50">
                        <div class="flex justify-between mb-3 items-start">
                            <div>
                                <strong class="text-teal-800 flex items-center gap-2 text-sm mb-1"><i data-lucide="snowflake" class="w-4 h-4"></i> Ú©ÛŒÙÛŒØª Ø¨Ø±Ù</strong>
                                <p class="text-sm font-bold text-teal-900">${analysis.surface.val}</p>
                            </div>
                            <div class="text-right">
                                <div class="dir-ltr font-black text-xl text-teal-600">${analysis.surface.freezeLvl}m</div>
                                <div class="text-[10px] opacity-60">Freezing Lvl</div>
                            </div>
                        </div>
                        <div class="text-xs text-teal-800/70 leading-relaxed">
                            <div class="mb-1">Ø¨Ø§Ø±Ø´: <span class="font-bold dir-ltr">${analysis.precipitation.val} mm</span></div>
                            <div>Ø§Ø±ØªÙØ§Ø¹ Ø§Ù†Ø¬Ù…Ø§Ø¯ ØªØ¹ÛŒÛŒÙ† Ù…ÛŒâ€ŒÚ©Ù†Ø¯ Ø¨Ø±Ù Ø¯Ø± Ú†Ù‡ Ø§Ø±ØªÙØ§Ø¹ÛŒ Ø°ÙˆØ¨ Ù…ÛŒâ€ŒØ´ÙˆØ¯.</div>
                        </div>
                    </div>

                    <!-- CAPE/Stability -->
                    <div class="glass-card p-5 rounded-3xl border-0 bg-purple-50/50">
                        <div class="flex justify-between mb-3 items-start">
                            <div>
                                <strong class="text-purple-800 flex items-center gap-2 text-sm mb-1"><i data-lucide="zap" class="w-4 h-4"></i> Ù¾Ø§ÛŒØ¯Ø§Ø±ÛŒ Ø¬Ùˆ (CAPE)</strong>
                                <p class="text-sm font-bold text-purple-900">${analysis.cape.cond}</p>
                            </div>
                            <div class="text-right">
                                <div class="dir-ltr font-black text-2xl text-purple-600">${analysis.cape.val}</div>
                                <div class="text-[10px] opacity-60">J/kg</div>
                            </div>
                        </div>
                        <p class="text-xs text-purple-800/70 leading-relaxed">${analysis.cape.rec}</p>
                    </div>
                    
                    <!-- Lifted Index -->
                    <div class="glass-card p-5 rounded-3xl border-0 bg-rose-50/50">
                        <div class="flex justify-between mb-3 items-start">
                            <div>
                                <strong class="text-rose-800 flex items-center gap-2 text-sm mb-1"><i data-lucide="arrow-up-down" class="w-4 h-4"></i> Ø´Ø§Ø®Øµ Ø¨Ù„Ù†Ø¯Ø´Ø¯Ú¯ÛŒ (LI)</strong>
                                <p class="text-sm font-bold text-rose-900">${analysis.liftedIndex.cond}</p>
                            </div>
                            <div class="text-right">
                                <div class="dir-ltr font-black text-2xl text-rose-600">${analysis.liftedIndex.val}</div>
                                <div class="text-[10px] opacity-60">Â°C</div>
                            </div>
                        </div>
                        <p class="text-xs text-rose-800/70 leading-relaxed">Ù…Ù‚Ø¯Ø§Ø± Ú©Ù…ØªØ± = Ø¬Ùˆ Ù†Ø§Ù¾Ø§ÛŒØ¯Ø§Ø±ØªØ±. Ù…Ù‚Ø¯Ø§Ø± Ù…Ù†ÙÛŒ Ù†Ø´Ø§Ù†â€ŒØ¯Ù‡Ù†Ø¯Ù‡ Ø§Ø­ØªÙ…Ø§Ù„ Ø±Ø¹Ø¯ÙˆØ¨Ø±Ù‚ Ø§Ø³Øª.</p>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            lucide.createIcons();
        }

        // --- 5. Utilities & Helpers ---

        function closeModal(e) {
            if (e && e.target.id !== 'hourly-modal' && !e.target.closest('button')) return;
            const m = document.getElementById('hourly-modal');
            m.classList.add('hidden');
            m.classList.remove('flex');
        }

        function renderDateSelector() {
            const container = document.getElementById('date-selector-list');
            container.innerHTML = '';
            for(let i=0; i<16; i++) {
                const d = getPersianDate(i);
                const active = i === selectedDayIndex;
                container.innerHTML += `
                    <button onclick="setDate(${i})" class="flex flex-col items-center justify-center px-5 py-3 rounded-2xl min-w-[95px] transition-all duration-300 ${active ? 'accent-bg text-white shadow-lg scale-105 font-bold' : 'bg-white/30 hover:bg-white/50'}">
                        <span class="text-xs opacity-80 mb-1">${d.day}</span>
                        <span class="whitespace-nowrap text-sm">${d.full}</span>
                    </button>
                `;
            }
            document.getElementById('date-selector-container').classList.remove('hidden');
        }

        function setDate(i) {
            selectedDayIndex = i;
            renderDateSelector();
            loadCards(currentSelection);
        }

        function setTheme(t) {
            document.body.className = `${t} flex flex-col`;
            localStorage.setItem('theme', t);
        }

        function askWhenSnow() {
            const res = document.getElementById('prediction-result');
            res.innerHTML = '<div class="glass-card p-6 rounded-3xl flex flex-col items-center gap-3"><i data-lucide="loader-2" class="animate-spin w-8 h-8 accent-text"></i><span class="text-sm font-bold opacity-60">Ø¯Ø± Ø­Ø§Ù„ Ø¬Ø³ØªØ¬ÙˆÛŒ Ø¨Ø±Ù...</span></div>';
            res.classList.remove('hidden');
            lucide.createIcons();

            setTimeout(() => {
                const data = weatherStore[currentSelection];
                if(!data) return;
                
                let bestDay = null;
                let maxSnow = 0;
                let snowByLocation = [];

                for (let dayIdx = 0; dayIdx < 16; dayIdx++) {
                    let dayTotal = 0;
                    let dayData = [];
                    
                    data.forEach((locData, locIdx) => {
                        const snow = locData.daily.snowfall_sum[dayIdx] || 0;
                        const prob = locData.daily.precipitation_probability_max[dayIdx] || 0;
                        dayTotal += snow;
                        dayData.push({ locIdx, snow, prob });
                    });
                    
                    if (dayTotal > maxSnow) {
                        maxSnow = dayTotal;
                        bestDay = dayIdx;
                        snowByLocation = dayData;
                    }
                }

                const res = document.getElementById('prediction-result');

                if (bestDay !== null && maxSnow > 0) {
                    const d = getPersianDate(bestDay);
                    const resort = RESORTS[currentSelection];

                    res.innerHTML = `
                        <div class="glass-card p-5 rounded-[2rem] bg-gradient-to-l from-sky-400 to-sky-500 text-white shadow-xl relative overflow-hidden">
                            
                            <!-- Snow Effect -->
                            <div class="absolute inset-0 overflow-hidden pointer-events-none">
                                <div class="snow-particle"></div>
                                <div class="snow-particle"></div>
                                <div class="snow-particle"></div>
                                <div class="snow-particle"></div>
                                <div class="snow-particle"></div>
                                <div class="snow-particle"></div>
                            </div>
                            
                            <!-- Title Section - Centered at Top -->
                            <div class="text-center mb-5 relative z-10">
                                <p class="text-white/80 font-bold text-xs mb-1">ğŸ‰ ÛŒÚ© Ø±ÙˆØ² Ø¨Ø±ÙÛŒ Ù¾ÛŒØ¯Ø§ Ø´Ø¯!</p>
                                <h3 class="text-xl font-black">${d.day} - ${d.full}</h3>
                            </div>

                            <!-- Locations Grid -->
                            <div class="grid grid-cols-3 gap-3 w-full relative z-10">
                                ${snowByLocation.map(item => {
                                    const loc = resort.locations[item.locIdx];
                                    let probColor = 'bg-gray-400';
                                    if (item.prob > 70) probColor = 'bg-green-400';
                                    else if (item.prob > 40) probColor = 'bg-amber-400';
                                    
                                    return `
                                        <div class="bg-white/15 backdrop-blur-sm rounded-xl p-3 border border-white/25 flex flex-col items-center gap-2">
                                            <div class="text-center">
                                                <div class="font-bold text-xs mb-0.5">${loc.name}</div>
                                                <div class="text-[9px] opacity-70 font-mono dir-ltr">${loc.alt}</div>
                                            </div>
                                            <div class="bg-white rounded-lg px-3 py-2 text-center">
                                                <div class="text-2xl font-black text-sky-600 dir-ltr">${Math.round(item.snow)}</div>
                                                <div class="text-[9px] text-gray-600 font-bold">Ø³Ø§Ù†ØªÛŒ</div>
                                            </div>
                                            <div class="${probColor} text-white px-2 py-0.5 rounded-full text-[9px] font-bold">
                                                ${item.prob}%
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    `;
                } else {
                    res.innerHTML = `
                        <div class="mt-4 p-5 rounded-3xl bg-orange-100 border border-orange-200 text-center">
                            <p class="text-orange-800 font-bold text-sm">ØªØ§ Û±Û¶ Ø±ÙˆØ² Ø¢ÛŒÙ†Ø¯Ù‡ Ø¨Ø±Ù Ø³Ù†Ú¯ÛŒÙ†ÛŒ Ù†Ø¯Ø§Ø±ÛŒÙ…!</p>
                            <p class="text-xs opacity-60 mt-1">Ø²Ù…Ø§Ù† Ù…Ù†Ø§Ø³Ø¨ÛŒ Ø¨Ø±Ø§ÛŒ Ù¾ÛŒØ³Øª Ú©ÙˆØ¨ÛŒØ¯Ù‡ Ø§Ø³Øª.</p>
                        </div>
                    `;
                }
                
                lucide.createIcons();
            }, 1200);
        }

        // Show Guides Modal
        function showGuides() {
            const modal = document.getElementById('hourly-modal');
            const content = document.getElementById('modal-content');
            document.getElementById('modal-title').innerText = 'Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ ÙÙ†ÛŒ Ùˆ Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯Ù‡Ø§';
            document.getElementById('modal-subtitle').innerText = 'Ø§Ø·Ù„Ø§Ø¹Ø§Øª ØªØ®ØµØµÛŒ Ø¨Ø±Ø§ÛŒ Ø§Ø³Ú©ÛŒâ€ŒØ¨Ø§Ø²Ø§Ù† Ø­Ø±ÙÙ‡â€ŒØ§ÛŒ';

            content.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <!-- Wind Table -->
                    <div class="glass-card p-6 rounded-[2rem] relative overflow-hidden group hover:shadow-lg transition-all duration-500">
                        <div class="absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r from-blue-400 to-cyan-500"></div>
                        <h3 class="font-bold text-lg mb-6 flex items-center gap-2 text-blue-900">
                            <i data-lucide="wind" class="w-5 h-5 text-blue-500"></i>
                            Ø§Ø³ØªØ§Ù†Ø¯Ø§Ø±Ø¯ Ø¨Ø§Ø¯ Ùˆ Ù„ÛŒÙØª
                        </h3>
                        <div class="space-y-3 text-xs opacity-90 max-h-[400px] overflow-y-auto pr-2">
                            <div class="p-3 rounded-xl bg-green-50/50 border border-green-100">
                                <div class="flex justify-between font-black text-green-700 mb-1"><span class="dir-ltr">0-20 km/h</span><span>Ø§ÛŒØ¯Ù‡â€ŒØ¢Ù„</span></div>
                                <p class="opacity-70 leading-relaxed">Ø´Ø±Ø§ÛŒØ· Ø¹Ø§Ù„ÛŒ. ØªÙ…Ø§Ù… Ù„ÛŒÙØªâ€ŒÙ‡Ø§ Ø¨Ø§Ø².</p>
                            </div>
                             <div class="p-3 rounded-xl bg-blue-50/50 border border-blue-100">
                                <div class="flex justify-between font-black text-blue-700 mb-1"><span class="dir-ltr">20-30 km/h</span><span>Ù…Ø­Ø³ÙˆØ³</span></div>
                                <p class="opacity-70 leading-relaxed">Ø¨Ø±Ù Ú©Ù…ÛŒ Ø¬Ø§Ø¨Ø¬Ø§ Ù…ÛŒâ€ŒØ´ÙˆØ¯ (Wind-drift). Ù„ÛŒÙØªâ€ŒÙ‡Ø§ Ø¨Ø§Ø².</p>
                            </div>
                            <div class="p-3 rounded-xl bg-yellow-50/50 border border-yellow-100">
                                <div class="flex justify-between font-black text-yellow-700 mb-1"><span class="dir-ltr">30-40 km/h</span><span>Ù…Ø´Ú©Ù„ Ù„Ø¨Ù‡â€ŒÚ¯ÛŒØ±ÛŒ</span></div>
                                <p class="opacity-70 leading-relaxed">ÛŒØ®â€ŒØ²Ø§ÛŒÛŒ Ø³Ø·Ø­ÛŒ. Ú©Ø§Ù‡Ø´ Ø¯ÛŒØ¯. Ø§Ø­ØªÙ…Ø§Ù„ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ù„ÛŒÙØª.</p>
                            </div>
                            <div class="p-3 rounded-xl bg-orange-50/50 border border-orange-100">
                                <div class="flex justify-between font-black text-orange-700 mb-1"><span class="dir-ltr">40-60 km/h</span><span>Ø±ÛŒØ³Ú© Ø¨Ø§Ù„Ø§</span></div>
                                <p class="opacity-70 leading-relaxed">ØªÙ„Ù‡â€ŒØ³ÛŒÚ˜Ù‡Ø§ ØºØ§Ù„Ø¨Ø§Ù‹ Ø¨Ø³ØªÙ‡. Ø¨Ø±Ù Ø³ÙØª/ÛŒØ®â€ŒØ²Ø¯Ù‡. Whiteout.</p>
                            </div>
                            <div class="p-3 rounded-xl bg-red-50/50 border border-red-100">
                                <div class="flex justify-between font-black text-red-700 mb-1"><span class="dir-ltr">60+ km/h</span><span>Ø·ÙˆÙØ§Ù†</span></div>
                                <p class="opacity-70 leading-relaxed">ØªØ¹Ø·ÛŒÙ„ÛŒ Ú©Ø§Ù…Ù„ Ù¾ÛŒØ³Øª. Ø¯ÛŒØ¯ Ù†Ø²Ø¯ÛŒÚ© ØµÙØ±.</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- CAPE Guide -->
                    <div class="glass-card p-6 rounded-[2rem] relative overflow-hidden group hover:shadow-lg transition-all duration-500">
                        <div class="absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r from-purple-400 to-pink-600"></div>
                        <h3 class="font-bold text-lg mb-6 flex items-center gap-2 text-purple-900">
                            <i data-lucide="zap" class="w-5 h-5 text-purple-500"></i>
                            Ù†Ø§Ù¾Ø§ÛŒØ¯Ø§Ø±ÛŒ Ø¬Ùˆ (CAPE)
                        </h3>
                         <div class="space-y-3 text-xs opacity-90 max-h-[400px] overflow-y-auto pr-2">
                            <div class="p-3 rounded-xl bg-green-50/50 border border-green-100">
                                <div class="flex justify-between font-black text-green-700 mb-1"><span class="dir-ltr">0</span><span>Ù¾Ø§ÛŒØ¯Ø§Ø±</span></div>
                                <p class="opacity-70">Ø¨Ù‡ØªØ±ÛŒÙ† Ø²Ù…Ø§Ù†Ø› Ø±Ø¹Ø¯ÙˆØ¨Ø±Ù‚ â‰ˆ ØµÙØ±</p>
                            </div>
                             <div class="p-3 rounded-xl bg-teal-50/50 border border-teal-100">
                                <div class="flex justify-between font-black text-teal-700 mb-1"><span class="dir-ltr">1-500</span><span>Ù†Ø§Ù¾Ø§ÛŒØ¯Ø§Ø±ÛŒ Ú©Ù…</span></div>
                                <p class="opacity-70">ØªØºÛŒÛŒØ±Ø§Øª Ù…Ø­Ù„ÛŒ Ú©ÙˆÚ†Ú© ÛŒØ§ Ø±Ú¯Ø¨Ø§Ø± Ù¾Ø±Ø§Ú©Ù†Ø¯Ù‡.</p>
                            </div>
                             <div class="p-3 rounded-xl bg-orange-50/50 border border-orange-100">
                                <div class="flex justify-between font-black text-orange-700 mb-1"><span class="dir-ltr">500-1000</span><span>Ø±Ø¹Ø¯ÙˆØ¨Ø±Ù‚ Ù¾Ø±Ø§Ú©Ù†Ø¯Ù‡</span></div>
                                <p class="opacity-70">Ø§Ø­ØªÛŒØ§Ø·Ø› Ø§Ø­ØªÙ…Ø§Ù„ ÙˆØ²Ø´ Ø¨Ø§Ø¯ Ù†Ø§Ú¯Ù‡Ø§Ù†ÛŒ (Gust).</p>
                            </div>
                             <div class="p-3 rounded-xl bg-red-50/50 border border-red-100">
                                <div class="flex justify-between font-black text-red-700 mb-1"><span class="dir-ltr">1000+</span><span>ØªÙˆÙØ§Ù† Ø®Ø·Ø±Ù†Ø§Ú©</span></div>
                                <p class="opacity-70">Ø®Ø·Ø± ØµØ§Ø¹Ù‚Ù‡ Ø¨Ø§Ù„Ø§. Ø§Ø±ØªÙØ§Ø¹Ø§Øª Ù†Ø±ÙˆÛŒØ¯.</p>
                            </div>
                        </div>
                    </div>

                    <!-- Lens Guide -->
                    <div class="glass-card p-6 rounded-[2rem] relative overflow-hidden group hover:shadow-lg transition-all duration-500">
                        <div class="absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r from-orange-400 to-amber-500"></div>
                        <h3 class="font-bold text-lg mb-6 flex items-center gap-2 text-amber-900">
                            <i data-lucide="glasses" class="w-5 h-5 text-amber-500"></i>
                            Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø§Ù†ØªØ®Ø§Ø¨ Ù„Ù†Ø²
                        </h3>
                        <div class="space-y-3 text-xs opacity-90 max-h-[400px] overflow-y-auto pr-2">
                            <div class="p-3 rounded-xl bg-gray-100/50 border border-gray-200">
                                <div class="flex justify-between font-black text-gray-700 mb-1"><span>Ø¢ÙØªØ§Ø¨ÛŒ Ø´Ø¯ÛŒØ¯</span><span class="dir-ltr">5-10%</span></div>
                                <p class="opacity-70">Ù„Ù†Ø² ØªÛŒØ±Ù‡/Ø¢ÛŒÙ†Ù‡â€ŒØ§ÛŒ. Ú©Ø§Ù‡Ø´ Ø®ÛŒØ±Ú¯ÛŒ.</p>
                            </div>
                            <div class="p-3 rounded-xl bg-amber-50/50 border border-amber-100">
                                <div class="flex justify-between font-black text-amber-700 mb-1"><span>Ø¢ÙØªØ§Ø¨ÛŒ Ù…ØªÙˆØ³Ø·</span><span class="dir-ltr">10-25%</span></div>
                                <p class="opacity-70">Ù„Ù†Ø² Ù‚Ù‡ÙˆÙ‡â€ŒØ§ÛŒ/Ø¨Ø±Ù†Ø²ÛŒ. ØªØ´Ø®ÛŒØµ Ø¹Ù…Ù‚.</p>
                            </div>
                            <div class="p-3 rounded-xl bg-orange-50/50 border border-orange-100">
                                <div class="flex justify-between font-black text-orange-700 mb-1"><span>Ù…ØªØºÛŒØ± / Ù†ÛŒÙ…Ù‡â€ŒØ§Ø¨Ø±ÛŒ</span><span class="dir-ltr">18-35%</span></div>
                                <p class="opacity-70">Ù„Ù†Ø² Ù†Ø§Ø±Ù†Ø¬ÛŒ/Ø±Ø². ØªÙ‚ÙˆÛŒØª Ø³Ø§ÛŒÙ‡â€ŒÙ‡Ø§.</p>
                            </div>
                             <div class="p-3 rounded-xl bg-rose-50/50 border border-rose-100">
                                <div class="flex justify-between font-black text-rose-700 mb-1"><span>Ù†ÙˆØ± ØªØ®Øª (Flat)</span><span class="dir-ltr">35-60%</span></div>
                                <p class="opacity-70">Ù„Ù†Ø² ØµÙˆØ±ØªÛŒ/Ø²Ø±Ø¯ Ø±ÙˆØ´Ù†. Ø¢Ø´Ú©Ø§Ø±Ø³Ø§Ø²ÛŒ Ù¾Ø³ØªÛŒ Ø¨Ù„Ù†Ø¯ÛŒ.</p>
                            </div>
                            <div class="p-3 rounded-xl bg-yellow-50/50 border border-yellow-100">
                                <div class="flex justify-between font-black text-yellow-700 mb-1"><span>Ù…Ù‡ / Whiteout</span><span class="dir-ltr">50-80%</span></div>
                                <p class="opacity-70">Ù„Ù†Ø² Ø²Ø±Ø¯ Ù‚ÙˆÛŒ. Ø­Ø¯Ø§Ú©Ø«Ø± Ú©Ù†ØªØ±Ø§Ø³Øª.</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
            lucide.createIcons();
        }

        // Init
        window.addEventListener('DOMContentLoaded', () => {
            const savedTheme = localStorage.getItem('theme') || 'theme-snow';
            setTheme(savedTheme);
            loadResort('tochal');
            lucide.createIcons();
        });
    </script>
</body>
</html>
